<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/px-vis-xy-chart/px-vis-xy-chart.html" >

<dom-module id="distribution-chart">
    <template>
       <px-vis-xy-chart
                chart-data="[[chartData]]"
                show-tooltip
                hide-register
                series-config="[[seriesConfig]]"></px-vis-xy-chart>
        <table>
            <thead>
            <tr>
                <th>time</th>
                <th>hits</th>
            </tr>
            </thead>
            <tbody>
            <template is="dom-repeat" items="[[chartData]]">
                <tr>
                    <td>time: [[item.delta]]s</td>
                    <td>hits: [[item.hits]]</td>
                </tr>
            </template>
            </tbody>
        </table>
    </template>

    <script>
        /**
         * @customElement
         * @polymer
         */
        class DistributionChart extends Polymer.Element {
            static get is() {
                return 'distribution-chart';
            }

            static get properties() {
                return {
                    data: {type: Array, observer: "_dataChanged"}
                };
            }

            _dataChanged(new_data) {
                console.log("distribution-chart", "dataChanged", new_data);
                if (!new_data) {
                    this.set("chartData", []);

                }
                else {
                    this.set("chartData", new_data
                        .map(entry => {
                            return {
                                x: new Number(entry.delta),
                                y: entry.hits,
                                delta: new Number(entry.delta),
                                hits: entry.hits
                            }
                        }).sort((a, b) => a.delta - b.delta));

                }
                this.set("seriesConfig", {
                    "deltaHits": {
                        name: "hits of duration",
                        x: "x",
                        y: "y",
                        "axis": {"id": "axis1", "side": "left", "number": "1"}
                    },
                });
            }

        }

        window.customElements.define(DistributionChart.is, DistributionChart);
    </script>
</dom-module>
